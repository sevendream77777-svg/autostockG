ui통합 파이프라인

[0단계] 데이터 공장 (Data Factory)

파일명 (MODELENGINE/UTIL/),역할 및 설명
update_raw_data.py,[1. 시세] 개별 종목의 시세 데이터(all_stocks_...)를 안전하게 백업하고 버전을 관리함.
make_kospi_index_10y.py,[2. KOSPI] KOSPI 지수 10년 치를 수집해서 kospi_data.parquet로 저장함. (RAW 폴더에 위치)
build_features.py,"[3. 피처] 시세와 KOSPI를 합쳐서 15개 핵심 지표(SMA, RSI 등)를 계산함."
build_unified_db.py,[4. DB통합] 계산된 피처를 AI 학습용 통합 DB 파일(HOJ_DB_V31.parquet)로 최종 저장함.
run_data_pipeline.py,[⚡ 전체] 위 1~4번 과정을 순서대로 한 방에 실행해주는 총괄 스크립트.

[1단계] 엔진 공장 (Engine Factory)

파일명 (MODELENGINE/UTIL/),역할 및 설명
train_engine_unified.py,"[통합 트레이너] 설정(예측일, 나무개수 등)에 따라 Research/Real 모드로 학습하고, 결과물(.pkl)을 생성함. 파일명에 데이터 날짜와 학습 정보를 자동으로 기록함."

[3단계] 타임머신 예측 (Prediction)

파일명 (MODELENGINE/UTIL/),역할 및 설명
predict_daily_top10.py,"[추천기] 선택한 엔진 파일과 날짜를 입력받아, 그 시점 기준 Top 10 추천 종목과 예측 점수, 상승 확률을 계산해서 출력함."

[통합 UI] 컨트롤 타워
파일명 (ui/ui_pages/),역할 및 설명
engine_manager.py,[엔진 매니저] 데이터 업데이트(0단계) → 학습(1단계) → 분석(2단계) → 예측(3단계)을 탭으로 나누어 관리하는 최종 완성된 UI 파일.

config_paths.py: 모든 파일이 서로의 위치를 절대 잃어버리지 않게 교통정리 해주는 나침반 파일.
version_utils.py: 주 임무는 **"덮어쓰기 방지"**. 중요 사용처: train_engine_unified.py (엔진 저장 전), build_features.py (피처 저장 전) 등, 핵심 함수: backup_existing_file(filepath, date_tag)

그외
-5d (예측 목표 / Horizon) 바꾸는 곳
MODELENGINE/UTIL/train_engine_unified.py
60일 (SMA_60, 이평선 등 피처 계산) 바꾸는 곳
MODELENGINE/UTIL/build_features.py
-------------------------------------------------------------------------------------

파이프라인 흐름(MODELENGINE/run_modelengine_top10.py):

RAW 업데이트: RAW/raw_patch.py 실행 → 원천 데이터 패치
지수 업데이트: RAW/make_kospi_index_10y.py 실행 → KOSPI 지수 최신화
피처 빌드: UTIL/build_features.py 실행 → RAW·KOSPI 반영한 최신 피처 생성 (FEATURE/features_V31.parquet)
DB 생성:
RESEARCH DB: UTIL/build_HOJ_DB_RESEARCH.py → HOJ_DB/RESEARCH/HOJ_DB_RESEARCH_V31.parquet
REAL DB: UTIL/build_HOJ_DB_REAL.py → HOJ_DB/REAL/HOJ_DB_REAL_V31.parquet
(피처가 새로 갱신된 경우에만 실행)
엔진 학습:
RESEARCH 엔진: UTIL/train_HOJ_ENGINE_RESEARCH.py → HOJ_ENGINE/RESEARCH/HOJ_ENGINE_RESEARCH_V31.pkl
REAL 엔진: UTIL/train_HOJ_ENGINE_REAL.py → HOJ_ENGINE/REAL/HOJ_ENGINE_REAL_V31.pkl
(DB가 새로 만들어진 경우에만 실행)
Top10 추천: UTIL/daily_recommender.py 실행 → 최종 추천 산출
RAW만 업데이트하는 구간: 1) RAW/raw_patch.py, 2) RAW/make_kospi_index_10y.py

피처까지 업데이트하는 구간: 3) UTIL/build_features.py (RAW·KOSPI 반영해 피처 생성)

RAW→피처→DB→엔진까지 연결해 도는 구간: 3) 피처 빌드 후, 조건 만족 시 4) DB 빌드 → 5) 엔진 학습 → 6) Top10 추천

추가 로직: 실행 전후로 features_V31.parquet, HOJ_DB_*, HOJ_ENGINE_*의 최신 날짜를 읽어 비교하고, 날짜가 새로 갱신된 경우에만 다음 단계(DB/엔진)를 수행해서 불필요한 중복 실행을 줄임.
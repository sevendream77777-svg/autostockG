###신규방 개설시 포함될 총4개의파일###
###1. 본파일(ai신규방...)###
###2.. kiwoom_api.py###
###3. 영웅문4(HTS) - 키움 REST API, 키움 OPEN API + TR 매칭_251106.xlsx###
###4. 키움 REST API 문서.xlsx###
###chatgpt에서는3,4항목 구글드라이버로 대체 https://drive.google.com/drive/folders/1QK0gOPlejyux4M4RVxThHzUvDm_RQat3?usp=sharing###
[AI 주의사항] 이 문서는 'V34 (호슬) 프로젝트'의 전체 구조입니다. 이 지시서에 명시된 규칙을 반드시 준수해야 합니다.
🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪
신규방 필수 지침 최근작업분 업데이트 사항

지금까지의 규칙에 “추가 업데이트”해야 할 항목들입니다.
✔ ① 피처 개수 고정 = 15개
앞으로 Hoj 엔진은
“SMA_20/40/60/90 포함한 15개 피처 구조”
이걸 절대 변경하지 않는다는 규칙

✔ ② 학습/검증 기간 고정
학습: 150101부터 검증 날짜 전날까지
검증: 데이터업데이트기준 최근 1년
최종엔진: 전체 재학습

✔ ⑦ 검증 리포트 자동 저장
[REST API 전용] 이 프로젝트는 키움증권 REST API를 독점적으로 사용합니다.  작업 시 구형 'Kiwoom Open API (OCX/COM 모듈)' 코드를 참조하면 에러가능성이 매우 높으니 주의하세요.
[파일의 위치나 폴더는 동의없이 절대 바꾸지 않습니다

[코드 요청 필수] 당신(AI)은 아래 나열된 .py 파일들의 소스 코드를 가지고 있지 않습니다.  코드 수정 또는 분석 요청을 받으면, "코드를 추측하지 말고" 반드시 사용자에게 해당 파일(예: kakao_notifier.py)을 업로드해 달라고 요청해야 합니다.

[제공 자료 우선] 이 프로젝트는 사용자가 제공한 영웅문4-API 매칭표와 kiwoom_api.py 문서를 '참고 자료'로 사용합니다.  당신의 일반 지식이 아닌, 사용자가 제공하는 참고 자료를 기반으로 작업해야 합니다.

[사용자의 pc환경은 윈도우11 64비트, Python 3.13.7 64비트, vs cond, git, git bash, gitlens, powershell을 사용하고 있습니다.

[이 문서의 정보는 지속되는 업데이트 등으로 사실과 다른 부분이 있을 수 있습니다. 이때는 반드시 물어보고 작업을 진행해야 합니다.

[코드 수정 작업시
1) 새 파일 생성 → 전체 파일(.py)로 제공 
2) 기존 파일 수정 → 20줄 이하 또는 2KB 미만이면 터미널에서 실행하면 수정되는 스크립트로 제공 
3) 기존 파일 수정 → 20줄 이상 또는 2KB 이상이면 전체 파일로 제공 
4) 실행이 필요한 스크립트는 전체 파일(.py)로 제공 터미널에서 python xxx.py로 실행
이는 방의 메모리등의 문제로 딜레이되는 현상을 방지하기 위함이니 특별한 상황이 아니면 꼭 지켜주세요


🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪🟪
모든 검증 결과는 Hoj_MODELREPORT 폴더로 자동 기록
1) HOJ_DB
RESEARCH → HOJ_DB_RESEARCH_V31.parquet
REAL → HOJ_DB_REAL_V31.parquet

2) HOJ_ENGINE
RESEARCH → HOJ_ENGINE_RESEARCH_V31.pkl
REAL → HOJ_ENGINE_REAL_V31.pkl

3) SLE_DB
REAL → SLE_DB_REAL_V21.parquet
RESEARCH → 없음(None)

4) SLE_ENGINE
REAL → SLE_ENGINE_REAL_V21.pkl
RESEARCH → 없음(None)

🌟호슬프로그램(주식추천 및 자동매매) 파이프라인🌟

이 프로젝트는 두 개의 독립된 프로그램으로 구성됩니다.

1. 추천 프로그램 (AI 분석 파이프라인) (주간) 자동 업데이트 실행: python run_weekly_update.py (재구축 시 약 30~40분 소요, 증분 업데이트 시 약 1분 소요) '오늘의 Top 10' 추천 종목 리스트를 생성하고 AI '뇌'를 최신화하는 **'오프라인 연구소'**입니다.

1-2 모든 파일의 파이프라인은 pipelineXXXXXX.txt에 따로 첨부 합니다.

1-4. Hoj 엔진 최신 구조 (V31, 15피처 통합형)
🧱 데이터 흐름 (4단계)
구분	단계/파일	설명	결과물
I	원본 데이터 확보	all_stocks_cumulative.parquet, kospi_index_10y.parquet	10년치 시세 및 KOSPI 지수
II	피처 엔지니어링	update_features_incrementally.py → build_database_V25.py	6개 원본으로 15개 피처 계산
III	엔진 DB 구축	HOJ_DB_REAL_V31.parquet	원본 + 15피처 + 라벨(5일수익률)
IV	모델 학습	train_HOJ_ENGINE_REA.py	LightGBM 기반 AI 모델 (HOJ_ENGINE_REAL_V30.pkl)
V	실전 예측	daily_recommender.py	Top10 추천, 실시간 예측

1-5. 피처 리스트 (15개)
SMA_20, SMA_40, SMA_60, SMA_90,
RSI_14, VOL_SMA_20,
MACD, MACD_Sig,
BBP_20, ATR_14,
STOCH_K, STOCH_D,
CCI_20, KOSPI_수익률, ALPHA_SMA_20

✔ 특징
SMA_40, SMA_90, KOSPI_수익률은 V21 그리드서치에서 추가된 확장형 피처.
ALPHA_SMA_20은 시장 대비 초과수익률로, 모델의 핵심 입력 중 하나.

1-6. 학습 및 검증 규칙

학습 데이터: (최근1년을 제외한 전기간)
검증 데이터: (최근1년)
최종 학습 후 재훈련: 10+a 전체기간으로 학습 → REAL_CHAMPION_MODEL_V25.pkl
튜닝 값: 트리수 500, 학습률 0.05, 복잡도 41
챔피언 가설: 입력 60일 / 예측 5일


2. 매매 프로그램 (주문 및 알림 봇)
***실행파일 python main_trading.py***
'추천 프로그램'의 결과를 받아 실제 주문과 알림을 실행하는 **'온라인 실전 부대'**입니다.

2-1. 핵심 실행 파일 (.py)
main_trading.py: '실전 매매'의 지휘자. (매매 대상 수동 설정, 매수 타이밍 계산, API/카톡 호출)
kiwoom_api.py: 키움증권 API(주문, 차트 조회) 실제 통신 담당.
token_manager.py: 키움 API 토큰 발급/관리 담당.
kakao_notifier.py: 카카오톡 알림 발송 및 토큰 관리 담당.

2-2. 설정 및 인증 파일 (.ini, .json)
config.ini: 모든 API 키(키움, 카카오), 계좌번호, 모드(실전/모의)를 저장하는 필수 핵심 설정 파일.
token.json: token_manager.py가 생성/관리하는 키움 인증 토큰 저장 파일.
kakao_token.json: kakao_notifier.py가 생성/관리하는 카카오 인증 토큰(Access/Refresh) 저장 파일.

config.ini
[API]
; 키움증권 REST API (실전/모의 공용) 현재 모의모드라서 내용 오픈해도 상관없음
APP_KEY = SyiD1cdO9BZHNNLw-BIHOEp5SEFUoJodPQ-5k7ZoUsM
APP_SECRET = ZG_veqJcWbyVoXpGAPXa_qmTB3lk_B9WQunFOTRqT9U
[ACCOUNT]
; 사용할 계좌번호 (8자리)
ACCOUNT_NO_8 = 81145342
; 계좌상품코드 (2자리, 주식 계좌는 보통 '01')
ACCOUNT_PROD_CD = 01

[SETTINGS]
; 모드: real (실전투자), paper (모의투자)
MODE = paper
; 로그 파일을 저장할 경로
LOG_PATH = ./logs/
; 수집한 데이터를 저장할 경로
DATA_PATH = ./data/

[KAKAO]
KAKAO_REST_API_KEY = e317935d509a338337c03cd172355024
; 🌟 방금 확보한 인증 코드 입력 🌟
KAKAO_AUTH_CODE = NdBO4lo2rWiiCG3NFpc72ZOcU7TulqwQC421L6w129YiNRHkKPgeTgAAAAQKDRSjAAABmnFyn3jokopMIboAuA